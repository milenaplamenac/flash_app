<!DOCTYPE html>
<html>

<head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="node_modules/materialize-css/dist/css/materialize.min.css"
        media="screen,projection" />
    <link type="text/css" rel="stylesheet" href="node_modules/@fortawesome/fontawesome-free/css/all.css" />
    <link type="text/css" rel="stylesheet" href="css/style.css" />

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        #coinsIcon {
            font-size: 3rem;
            color: rgb(255, 115, 0);
        }

        .bold {
            font-weight: bold;
        }

        #phone_icon {
            color: #26a69a;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</head>

<body>


    <div class="row">
        <div id="main" class="col s12 m6 l4 offset-m3 offset-l4">
            <!-- Navigation bar -->
            <nav>
                <div class="nav-wrapper">
                    <a href="#" class="brand-logo  sidenav-trigger" data-target="slide-out">
                        <i class="material-icons" id="mobile-menu-icon">menu</i>
                    </a>
                    <ul id="nav-mobile" class="right hide-on-med-and-down">
                        <li><a href="#" data-target="slide-out" class="sidenav-trigger"><i
                                    class="material-icons">menu</i></a></li>
                        <li><a id="settings_button" id="logout-button">Podešavanja</a></li>
                    </ul>
                </div>
            </nav>

            <!-- Profile  -->
            <div id="profile">
                <div class="container">
                    <div class="row flex">
                        <div class="col s8">
                            <p>Dobrodošli,</p>
                            <h5>Marko Marković</h5>
                            <p>Stanje na računu,</p>
                            <h5 class="bold">986,55<i class="fas fa-euro-sign"></i></h5>
                        </div>
                        <div class="col s4 valign-wrapper">
                            <i class="fas fa-coins" id="coinsIcon"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent transactions -->
            <div id="recentTransactions">
                <h5>Posljednje transakcije</h5>
                <table>
                    <tbody>
                        <tr>
                            <td><i class="far fa-check-circle confirmed"></i></td>
                            <td>
                                <p>Telekom Crna Gora</p>
                                <p>07.10.2021. 18:28</p>
                            </td>
                            <td style="font-weight: bold;">32.26<i class="fas fa-euro-sign"></i></td>
                        </tr>
                        <tr>
                            <td><i class="far fa-check-circle pending"></i></td>
                            <td>
                                <p>Aroma Delta City</p>
                                <p>07.10.2021. 09:56</p>
                            </td>
                            <td style="font-weight: bold;">89.28<i class="fas fa-euro-sign"></i></td>
                        </tr>
                        <tr>
                            <td><i class="far fa-check-circle confirmed"></i></td>
                            <td>
                                <p>EPCG</p>
                                <p>03.10.2021. 10:38</p>
                            </td>
                            <td style="font-weight: bold;">91.22<i class="fas fa-euro-sign"></i></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div id="flash">
                <h5>FLASH</h5>
                <div class="container">
                    <a class="waves-effect waves-light btn modal-trigger" href="#sendMoneyModal">
                        <i class="material-icons left">local_phone</i>Prenos</a>

                    <a href="#codeModal" class="waves-effect waves-light btn modal-trigger" onclick="setFlashCode()"><i
                            class="material-icons left">loop</i>Zatraži kod</a>

                    <div id="sendMoneyModal" class="modal">
                        <div class="modal-content">
                            <h4>Prenos sredstava</h4>
                            <hr>
                            <div class="row">
                                <form class="col s12">
                                    <div class="row">
                                        <div class="input-field col s12">
                                            <i class="material-icons prefix" id="phone_icon"
                                                onclick="location.href = 'kontakti.html'">phone</i>
                                            <input id="icon_telephone" type="tel" class="validate right-align">
                                            <label for="icon_telephone">Telefon</label>
                                            <span class="helper-text" data-error="wrong"
                                                data-success="Validan FLASH broj">(Klik na
                                                ikonicu telefona za pregled kontakata)</span>
                                        </div>
                                        <div class="input-field col s12">
                                            <i class="material-icons prefix">euro_symbol</i>
                                            <input id="icon_prefix" type="text" class="validate right-align">
                                            <label for="icon_prefix">Iznos</label>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <a class="modal-close waves-effect waves-green btn-flat">Odustani</a>
                            <a onclick="validateTransactionInput()"
                                class="waves-effect waves-green btn-flat">Potvrda</a>
                        </div>
                    </div>

                    <div id="pinModal" class="modal">
                        <div class="modal-content">
                            <h4>Potvrdite transakciju</h4>
                            <hr>
                            <div class="row">
                                <form class="col s12">
                                    <div class="row">
                                        <div class="col s4 m4 l4 center-align">
                                            <a class="waves-effect waves-light btn">1</a>
                                        </div>
                                        <div class="col s4 m4 l4 center-align">
                                            <a class="waves-effect waves-light btn">2</a>
                                        </div>
                                        <div class="col s4 m4 l4 center-align">
                                            <a class="waves-effect waves-light btn">3</a>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col s4 m4 l4 center-align">
                                            <a class="waves-effect waves-light btn">4</a>
                                        </div>
                                        <div class="col s4 m4 l4 center-align">
                                            <a class="waves-effect waves-light btn">5</a>
                                        </div>
                                        <div class="col s4 m4 l4 center-align">
                                            <a class="waves-effect waves-light btn">6</a>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col s4 m4 l4 center-align">
                                            <a class="waves-effect waves-light btn">7</a>
                                        </div>
                                        <div class="col s4 m4 l4 center-align">
                                            <a class="waves-effect waves-light btn">8</a>
                                        </div>
                                        <div class="col s4 m4 l4 center-align">
                                            <a class="waves-effect waves-light btn">9</a>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col s4 m4 l4 center-align offset-s4 offset-m4 offset-l4">
                                            <a class="waves-effect waves-light btn">0</a>
                                        </div>
                                    </div>

                                </form>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <a id="#transferDone" class="modal-close waves-effect waves-green btn-flat"
                                onclick="successTransaction()">U redu</a>
                        </div>
                    </div>

                    <div id="codeModal" class="modal">
                        <div class="modal-content">
                            <h4>Vaš FLASH code</h4>
                            <hr>
                            <div class="row">
                                <div class="input-field col s12">
                                    <input disabled value="832056" id="flashCode" type="text"
                                        class="validate center-align">
                                </div>

                                <div class="col s12">
                                    <h6><span>Kod validan još: </span><span id="codeTimer"></span></h6>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <a class="modal-close waves-effect waves-green btn-flat"
                                onclick="clearTimer = true;">Zatvori</a>
                            <a href="#pinModal" class="modal-trigger waves-effect waves-green btn-flat">Potvrdi</a>
                        </div>
                    </div>

                </div>
            </div>


        </div>
    </div>


    <!--JavaScript at end of body for optimized loading-->
    <script type="text/javascript" src="node_modules/materialize-css/dist/js/materialize.min.js"></script>
    <script type="text/javascript" src="node_modules/@fortawesome/fontawesome-free/js/all.js"></script>
    <script type="text/javascript" src="node_modules/jquery/dist/jquery.min.js"></script>

    <script>
        var urlParams = new URLSearchParams(window.location.search);

        var flash_activated;
        var phone;
        var amount;

        if (urlParams.has('flash_activated'))
            var flash_activated = urlParams.get('flash_activated');
        else
            flash_activated = false;

        if (urlParams.has('phone'))
            var phone = urlParams.get('phone');
        else
            phone = false;

        if (urlParams.has('amount'))
            var amount = urlParams.get('amount');
        else
            amount = false;

        if (phone != false && amount != false) {
            var table = document.querySelector("#recentTransactions table tbody");
            // TODO: Be careful on December
            var newDate = (new Date()).getDate() + '.' + ((new Date()).getMonth() + 1) + '.' + (new Date()).getFullYear() + '. ' + (new Date()).getHours() + ':' + (new Date()).getMinutes();
            var newTransactionNode = document.createElement("tr");
            newTransactionNode.innerHTML = `<tr>
                                                <td>Flash</td>
                                                <td>
                                                    <p>` + phone + `</p>
                                                    <p>` + newDate + `</p>
                                                </td>
                                                <td style="font-weight: bold;">` + amount + `<i class="fas fa-euro-sign"></i></td>
                                            </tr>`;

            table.appendChild(newTransactionNode);
        }


        var settingsButton = document.getElementById('settings_button');
        settingsButton.href = "settings.html?flash_activated=" + flash_activated;

        document.addEventListener('DOMContentLoaded', function () {
            var elems = document.querySelectorAll('.modal');
            var instances = M.Modal.init(elems, {});
        });
    </script>

    <script>
        var clearTimer = false;

        function setFlashCode() {
            document.getElementById("codeTimer").innerHTML = "";
            var countDownDate = new Date((new Date()).getTime() + 2 * 60000).getTime();
            console.log(countDownDate);
            var x = setInterval(function () {
                var now = new Date().getTime();
                var distance = countDownDate - now;
                var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                var seconds = Math.floor((distance % (1000 * 60)) / 1000);
                document.getElementById("codeTimer").innerHTML = minutes + "m " + seconds + "s ";
                if (distance < 0 || clearTimer) {
                    clearInterval(x);
                    clearTimer = false;
                    document.getElementById("codeTimer").innerHTML = "Vaš kod je istekao. Molimo zatražite novi u slučaju potrebe.";
                }
            }, 1000);
        }
    </script>

    <script>
        function validateTransactionInput() {
            var phone = document.getElementById('icon_telephone').value;
            var amount = document.getElementById('icon_prefix').value;

            if (!phone || !amount) {
                M.toast({ html: 'Za potvrdu transakcije potrebno je unijeti broj telefona i iznos!' });
                return;
            }

            var pinModalInstance = M.Modal.getInstance(document.getElementById('pinModal'));
            var sendModalModalInstance = M.Modal.getInstance(document.getElementById('sendMoneyModal'));

            sendModalModalInstance.close();
            pinModalInstance.open();
        }

        function successTransaction() {
            var phone = document.getElementById('icon_telephone').value;
            var amount = document.getElementById('icon_prefix').value;
            location.href = "index.html?phone=" + phone + "&amount=" + amount;
        }
    </script>
</body>

</html>